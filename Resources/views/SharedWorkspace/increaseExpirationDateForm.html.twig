{% set layout = "ClarolineCoreBundle:Desktop:layout.html.twig" %}

{% extends layout %}

{% block breadcrumb %}
    {{
        macros.desktopBreadcrumbs([
            {
                'name': 'formalibre'|trans({}, 'platform'),
                'href': path('invoice_show_all')
            },
            {
                'name': workspace.name,
                'href': ''
            }
        ])
    }}
{% endblock %}

{% block content %}

<div class="section-content">
    <div class="panel panel-default">
        <div class="panel-body">
            <div class="well">
                <div class="well">
                    {{ 'expiration_date'|trans({}, 'invoice')}}: {{ workspace.expiration_date|date('d/m/Y') }} </br>
                    Under construction...
                </div>
            </div>
            <div class="row">
                {% for form in forms %}
                    <div
                        id="{{ form['product'].getCode() }}"
                        class="col-md-3 div-product"
                        data-is-available='{{ form['is_available'] }}'
                    >
                        <div class="well">
                            {{
                                'SHARE_WS_DESCRIPTION'|trans(
                                    {
                                        '%code%': form['product'].getCode()|trans({}, 'invoice'),
                                        '%users%': form['product'].details.max_users,
                                        '%storage%': form['product'].details.max_storage,
                                        '%resources%': form['product'].details.max_resources
                                    },
                                    'invoice'
                                )|raw
                            }}
                        </div>
                        <form action="{{ path('workspace_product_payment_submit', {'product': form['product'].getId(), 'order': form['order'].getId(), 'swsId': sws.getId() }) }}" method="post">
                            {% form_theme form['form'] 'FormaLibreInvoiceBundle::form_theme_payment.html.twig' %}
                            {{ form_widget(form['form']) }}
                            <input type="submit" class="btn btn-primary" value="{{'add'|trans({}, 'platform')}}"/>
                        </form>
                        {% if form['is_available'] != 1 %}
                            </br>
                            <div class="panel-body alert alert-danger">
                                {{ 'requirements_not_met'|trans({}, 'invoice') }}
                            </div>
                        {% endif %}
                    </div>
                {% endfor %}
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block javascripts %}
    {{ parent() }}
    <script>
        $('.div-product').each(function(i) {
            if ($(this).attr('data-is-available') === '0') {
                $("#" + $(this).attr('id') + " :input").prop("disabled", true);
            }
        })

    </script>
{% endblock %}
